<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sections - Student Result Management System</title>
  <link rel="stylesheet" href="Css/style.css">
  <link rel="stylesheet" href="Css/style_section.css">

</head>
<body>

  <div class="main-card">

    <div class="card-header">
      <h1>Student Result Management System</h1>
      <p>Manage students, sections, and academic results</p>
    </div>

    <div class="tabs">
      <button onclick="window.location.href='dashboard.html';">Students</button>
      <button onclick="location.reload();">Sections</button>
      <button onclick="window.location.href='result.html';">Results</button>
    </div>

    <div class="content">

      <div class="section-header">
        <h2>Section Management</h2>
        <button id="openAdd">Add New Section</button>
      </div>

      <table border="1">
        <thead>
          <tr>
            <th>NAME</th>
            <th>DESCRIPTION</th>
            <th>TOTAL STUDENTS</th>
            <th>ACTIONS</th>
          </tr>
        </thead>

        <tbody id="tableBody">
          <tr>
            <td colspan="4">Loading sections...</td>
          </tr>
        </tbody>
      </table>

    </div>
  </div>

  <div id="modalBackdrop" style="display:none;">
    <div class="modal">
      <h3 id="modalTitle">Add New Section</h3>

      <label>Name:</label>
      <input id="secName" type="text" required>
      <br><br>

      <label>Description:</label>
      <textarea id="secDesc" rows="4"></textarea>
      <br><br>

      <button id="cancelBtn">Cancel</button>
      <button id="saveBtn">Save</button>
    </div>
  </div>

<script>
  let students = [];
  let sections = [];
  let editId = null;

  // Load data
  function loadData() {
    let data = localStorage.getItem('students');
    if (data) students = JSON.parse(data);
    
    let secData = localStorage.getItem('sections');
    if (secData) sections = JSON.parse(secData);
  }

  // Save data
  function saveData() {
    localStorage.setItem('students', JSON.stringify(students));
    localStorage.setItem('sections', JSON.stringify(sections));
  }

  // Show sections
  function showSections() {
    let tbody = document.getElementById('tableBody');
    tbody.innerHTML = '';

    if (sections.length === 0) {
      tbody.innerHTML = '<tr><td colspan="4">No sections found</td></tr>';
      return;
    }

    sections.forEach(section => {
      let count = students.filter(s => s.section === section.name).length;

      let row = '<tr>' +
        '<td>' + section.name + '</td>' +
        '<td>' + section.desc + '</td>' +
        '<td>' + count + '</td>' +
        '<td>' +
          '<button onclick="editSection(\'' + section.id + '\')">Edit</button> ' +
          '<button onclick="deleteSection(\'' + section.id + '\')">Delete</button>' +
        '</td>' +
      '</tr>';
      tbody.innerHTML += row;
    });
  }

  // Show modal
  function showModal() {
    document.getElementById('modalBackdrop').style.display = 'block';
  }

  // Hide modal
  function hideModal() {
    document.getElementById('modalBackdrop').style.display = 'none';
  }

  // Add section
  function addSection(name, desc) {
    let section = {
      id: Date.now().toString(),
      name: name,
      desc: desc
    };
    sections.push(section);
    saveData();
    showSections();
  }

  // Edit section
  function editSection(id) {
    let section = sections.find(s => s.id === id);
    if (section) {
      editId = id;
      document.getElementById('secName').value = section.name;
      document.getElementById('secDesc').value = section.desc;
      document.getElementById('modalTitle').textContent = 'Edit Section';
      document.getElementById('saveBtn').textContent = 'Update';
      showModal();
    }
  }

  // Update section
  function updateSection(id, name, desc) {
    let index = sections.findIndex(s => s.id === id);
    if (index !== -1) {
      let oldName = sections[index].name;
      sections[index].name = name;
      sections[index].desc = desc;

      // Update students
      students.forEach(s => {
        if (s.section === oldName) s.section = name;
      });

      saveData();
      showSections();
    }
  }

  // Delete section
  function deleteSection(id) {
    let section = sections.find(s => s.id === id);
    if (confirm('Delete section "' + section.name + '"?')) {
      sections = sections.filter(s => s.id !== id);
      saveData();
      showSections();
    }
  }

  // Open add
  document.getElementById('openAdd').onclick = function() {
    document.getElementById('secName').value = '';
    document.getElementById('secDesc').value = '';
    editId = null;
    document.getElementById('modalTitle').textContent = 'Add New Section';
    document.getElementById('saveBtn').textContent = 'Save';
    showModal();
  };

  // Cancel button
  document.getElementById('cancelBtn').onclick = function() {
    hideModal();
  };

  // Save button
  document.getElementById('saveBtn').onclick = function() {
    let name = document.getElementById('secName').value.trim();
    let desc = document.getElementById('secDesc').value.trim();

    if (!name) return;

    if (editId) {
      updateSection(editId, name, desc); // Update existing
    } else {
      addSection(name, desc); // Add new
    }

    hideModal();
  };

  // Start app
  loadData();
  showSections();
</script>

</body>
</html>
